<div class="row pl-3 pr-3">
  <div class="mx-auto pb-2">
    <button type="button" class="btn btn-sm btn-outline-success" data-toggle="modal" data-target="#AgregarArea" ><i class="fas fa-clone"></i> Agregar área</button>
    <button type="button" class="btn btn-sm btn-outline-warning"><i class="fas fa-th-list"></i> Vista general</button>
    <button type="button" id="salvarMovimientos" class="btn btn-sm btn-outline-info"><i class="fas fa-arrows-alt"></i> Sincronizar cambios</button>
  </div>
  <div id="containment-wrapper" style="width: 100%; height: 78vh; min-height: 400px;">
    <div id="mapa" style="border-radius: 10px; border: 2px solid #333333;">

    </div>
  </div>
  <div class="modal fade" id="AgregarArea" tabindex="-1" role="dialog" aria-labelledby="AgregarAreaLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="AgregarAreaLabel"><i class="fas fa-plus-square"></i> Agregar área</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
  		<div class="input-group mb-3">
  		  <div class="input-group-prepend">
  			<span class="input-group-text">Nombre:</span>
  		  </div>
  		  <input id="nombreArea" type="text" class="form-control" placeholder="Nombre del área" aria-label="Nombre del área">
  		</div>
  		<div class="input-group mb-3">
  		  <div class="input-group-prepend">
  			<span class="input-group-text">Estado actual:</span>
  		  </div>
        <select id="estado" class="form-control">
  		    <option value="1" selected>Dispinible</option>
  		    <option value="2">Ocupada</option>
  		    <option value="0">No disponible</option>
  		  </select>
  		</div>
  		<div class="input-group mb-3">
  		  <div class="input-group-prepend">
  			<span class="input-group-text">Equipos activos en el área:</span>
  		  </div>
  		  <select id="equipos" class="form-control" style="width: 100%;" multiple="multiple">
  		    <option>Antena número 1</option>
  		    <option>Switch Cisco 2660</option>
  		    <option>Antena de largo alcance</option>
  		  </select>
  		</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
          <button id="AgregarAreaButton" type="button" class="btn btn-primary">Confirmar</button>
        </div>
      </div>
    </div>
  </div>
  <script src="/socket.io/socket.io.js" charset="utf-8"></script>
  <script>

    const socket = io();

    var hotel_id = {{ hotel.id }};
    var width = {{ hotel.width }};
    var height = {{ hotel.height }};
    var left = {{ hotel.left }};
    var top = {{ hotel.top }};
    var hotel_mapa = "{{ hotel.mapa }}";

    var allAreas = null;

    $(window).load(function() {

      socket.emit('init', {

          hotel_id: hotel_id

      });

      $("#equipos").select2({
        placeholder: 'Ninguno',
        allowClear: true
      });

    });

  </script>
  <script src="/js/dashboard/context-menu.js"></script>
  <script>
    $(window).load(function() {

      //Script Movimientos

      $("#mapa").css("width", width + "%");
      $("#mapa").css("height", height + "%");
      $("#mapa").css("left", left + "%");
      $("#mapa").css("top", top + "%");
      $("#mapa").css("background-image", "linear-gradient(rgba(0, 0, 0, 0.350), rgba(0, 0,0, 0.350)), url(" + hotel_mapa + ")");
      $("#mapa").css("background-position", "center center");
      $("#mapa").css("background-repeat", "no-repeat");
      $("#mapa").css("background-size", "100% 100%");
      $("#mapa").css("background-color", "black");

      $( "#mapa" ).draggable({
        containment: "#containment-wrapper",
        stop: function(e, ui) { ajustarMapa(1); }
      });

      $( "#mapa" ).resizable({
        containment: "#containment-wrapper",
        minHeight: 250,
        minWidth: 400,
        stop: function(e, ui) { ajustarMapa(2); }
      });

      function ajustarMapa(action) {

        var anchoBase = $("#containment-wrapper").width();
        var largoBase = $("#containment-wrapper").height();
        var anchoMapa = $("#mapa").width();
        var largoMapa = $("#mapa").height();
        var leftMapa = $("#mapa").css("left").split("px")[0];
        var topMapa = $("#mapa").css("top").split("px")[0];
        if(parseInt(leftMapa) < 0) leftMapa = 0;
        if(parseInt(topMapa) < 0) topMapa = 0;

        width = Math.ceil(((anchoMapa * 100) / anchoBase));
        height = Math.ceil(((largoMapa * 100) / largoBase));
        left = Math.ceil(((leftMapa * 100) / anchoBase));
        top = Math.ceil(((topMapa * 100) / largoBase));

        if(action == 1) {
          $("#mapa").css("left", left + "%");
          $("#mapa").css("top", top + "%");
        } else {
          $("#mapa").css("width", width + "%");
          $("#mapa").css("height", height + "%");
        }

      }

      $("#salvarMovimientos").click(function() {

        socket.emit('sincronizacion', {

            sitio: hotel_id,
            width: width,
            height: height,
            left: left,
            top: top,
            areas: allAreas

        });

      });

    });
  </script>
  <script src="/js/dashboard/areas.js"></script>
</div>
